# گزینه‌های بهینه‌سازی وابستگی‌ها

- **مرتبط:** [پیش‌باندل کردن وابستگی‌ها](/guide/dep-pre-bundling)

مگر آنکه ذکر شده باشد، گزینه‌های این بخش فقط به بهینه‌ساز وابستگی‌ها اعمال می‌شوند که فقط در حالت توسعه استفاده می‌شود.

## optimizeDeps.entries

- **نوع:** `string | string[]`

به‌طور پیش‌فرض، Vite همه فایل‌های `.html` شما را برای شناسایی وابستگی‌هایی که نیاز به پیش‌باندل دارند جستجو می‌کند (مگر `node_modules`، `build.outDir`، `__tests__` و `coverage`). اگر `build.rollupOptions.input` مشخص شود، Vite به جای آن ورودی‌ها را جستجو خواهد کرد.

اگر هیچ‌کدام از این موارد نیاز شما را برآورده نکرد، می‌توانید ورودی‌های سفارشی را با استفاده از این گزینه مشخص کنید - مقدار آن باید یک الگوی [`tinyglobby`](https://github.com/SuperchupuDev/tinyglobby) یا آرایه‌ای از الگوهای نسبی نسبت به ریشه پروژه Vite باشد. این مورد استنباط ورودی‌های پیش‌فرض را بازنویسی خواهد کرد. تنها پوشه‌های `node_modules` و `build.outDir` به‌طور پیش‌فرض نادیده گرفته خواهند شد وقتی که `optimizeDeps.entries` به‌طور صریح تعریف شود. اگر نیاز به نادیده‌گرفتن پوشه‌های دیگر دارید، می‌توانید از الگوی نادیده‌گرفتن به‌عنوان بخشی از لیست ورودی‌ها استفاده کنید که با `!` آغاز می‌شود. اگر نمی‌خواهید `node_modules` و `build.outDir` نادیده گرفته شوند، می‌توانید از مسیرهای رشته‌ای معین (بدون الگوهای `tinyglobby`) استفاده کنید.

## optimizeDeps.exclude

- **نوع:** `string[]`

وابستگی‌هایی که باید از پیش‌باندل کردن خارج شوند.

:::warning CommonJS
وابستگی‌های CommonJS نباید از بهینه‌سازی خارج شوند. اگر یک وابستگی ESM از بهینه‌سازی خارج شود، اما دارای وابستگی CommonJS تو در تو باشد، آن وابستگی CommonJS باید به `optimizeDeps.include` اضافه شود. به‌عنوان مثال:

```js twoslash
import { defineConfig } from 'vite'
// ---cut---
export default defineConfig({
  optimizeDeps: {
    include: ['esm-dep > cjs-dep'],
  },
})
```

:::

## optimizeDeps.include

- **نوع:** `string[]`

به‌طور پیش‌فرض، بسته‌های پیوندی که داخل `node_modules` نیستند پیش‌باندل نمی‌شوند. از این گزینه برای مجبور کردن بسته پیوندی به پیش‌باندل شدن استفاده کنید.

**تجربی:** اگر از کتابخانه‌ای با واردات عمیق زیاد استفاده می‌کنید، می‌توانید یک الگوی گلوب انتهایی را برای پیش‌باندل کردن همه واردات عمیق یکجا مشخص کنید. این کار از پیش‌باندل کردن مداوم زمانی که واردات عمیق جدیدی استفاده می‌شود، جلوگیری می‌کند. [بازخورد دهید](https://github.com/vitejs/vite/discussions/15833). به‌عنوان مثال:

```js twoslash
import { defineConfig } from 'vite'
// ---cut---
export default defineConfig({
  optimizeDeps: {
    include: ['my-lib/components/**/*.vue'],
  },
})
```

## optimizeDeps.esbuildOptions

- **نوع:** [`Omit`](https://www.typescriptlang.org/docs/handbook/utility-types.html#omittype-keys)`<`[`EsbuildBuildOptions`](https://esbuild.github.io/api/#general-options)`,
| 'bundle'
| 'entryPoints'
| 'external'
| 'write'
| 'watch'
| 'outdir'
| 'outfile'
| 'outbase'
| 'outExtension'
| 'metafile'>`

گزینه‌هایی برای ارسال به esbuild در طول اسکن وابستگی‌ها و بهینه‌سازی آنها.

برخی گزینه‌ها حذف شده‌اند زیرا تغییر آنها با بهینه‌سازی وابستگی‌های Vite سازگار نیست.

- `external` نیز حذف شده است، از گزینه `optimizeDeps.exclude` Vite استفاده کنید
- `plugins` با پلاگین‌های وابستگی‌های Vite ترکیب می‌شود

## optimizeDeps.force

- **نوع:** `boolean`

برای مجبور کردن پیش‌باندل کردن وابستگی‌ها، مقدار آن را به `true` تنظیم کنید، بدون در نظر گرفتن وابستگی‌های بهینه‌شده کش شده قبلی.

## optimizeDeps.holdUntilCrawlEnd

- **تجربی:** [بازخورد دهید](https://github.com/vitejs/vite/discussions/15834)
- **نوع:** `boolean`
- **پیش‌فرض:** `true`

هنگامی که فعال باشد، نتایج وابستگی‌های بهینه‌شده اول تا زمانی که همه واردات ایستا در شروع سرد جستجو شوند، نگه داشته می‌شوند. این از نیاز به بارگذاری مجدد کامل صفحه زمانی که وابستگی‌های جدید شناسایی شده و منجر به تولید چانک‌های جدید می‌شوند جلوگیری می‌کند. اگر تمام وابستگی‌ها توسط اسکنر به‌اضافه آنهایی که به‌طور صریح در `include` تعریف شده‌اند یافت شوند، بهتر است این گزینه غیرفعال شود تا مرورگر بتواند درخواست‌ها را به‌طور موازی پردازش کند.

## optimizeDeps.disabled

- **قدیمی**
- **تجربی:** [بازخورد دهید](https://github.com/vitejs/vite/discussions/13839)
- **نوع:** `boolean | 'build' | 'dev'`
- **پیش‌فرض:** `'build'`

این گزینه قدیمی است. از نسخه 5.1 Vite، پیش‌باندل کردن وابستگی‌ها در طول ساخت حذف شده است. تنظیم `optimizeDeps.disabled` به `true` یا `'dev'` بهینه‌ساز را غیرفعال می‌کند، و تنظیم آن به `false` یا `'build'` بهینه‌ساز را در حالت توسعه فعال می‌کند.

برای غیرفعال کردن کامل بهینه‌ساز، از `optimizeDeps.noDiscovery: true` استفاده کنید تا کشف خودکار وابستگی‌ها غیرممکن شود و `optimizeDeps.include` را تعریف نکرده یا خالی بگذارید.

:::warning
بهینه‌سازی وابستگی‌ها در زمان ساخت یک ویژگی **تجربی** بود. پروژه‌هایی که از این استراتژی استفاده کرده‌اند همچنین `@rollup/plugin-commonjs` را با استفاده از `build.commonjsOptions: { include: [] }` حذف کردند. اگر این کار را انجام داده‌اید، یک هشدار شما را راهنمایی می‌کند تا آن را دوباره فعال کنید تا از بسته‌بندی بسته‌های CJS پشتیبانی شود.
:::

## optimizeDeps.needsInterop

- **تجربی**
- **نوع:** `string[]`

برای اجبار به استفاده از ESM interop هنگام وارد کردن این وابستگی‌ها. Vite قادر است به‌درستی تشخیص دهد که کدام وابستگی به interop نیاز دارد، بنابراین این گزینه به‌طور کلی مورد نیاز نیست. با این حال، ترکیب‌های مختلف وابستگی‌ها ممکن است باعث شود برخی از آنها به‌طور متفاوت پیش‌باندل شوند. افزودن این بسته‌ها به `needsInterop` می‌تواند زمان شروع سرد را تسریع کند و از بارگذاری مجدد کامل صفحه جلوگیری کند. اگر این مسئله برای یکی از وابستگی‌های شما پیش آید، هشداری دریافت خواهید کرد که پیشنهاد می‌کند نام بسته را به این آرایه در پیکربندی خود اضافه کنید.